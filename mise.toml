[tools]
dotnet = ["10"]

[tasks.build]
description = "Build the solution"
run = "dotnet build"

[tasks.build-release]
description = "Build the solution in Release configuration"
run = "dotnet build -c Release"

[tasks.test]
description = "Run all tests"
run = "dotnet test"

[tasks.clean]
description = "Clean build artifacts"
run = "dotnet clean"

[tasks.restore]
description = "Restore NuGet packages"
run = '''
dotnet restore
dotnet tool restore
'''

[tasks.format]
description = "Format code using CSharpier"
depends = ["restore"]
run = "dotnet csharpier format ."

[tasks.install]
description = "Install the plugin to the NuGet plugins directory (on macOS/Linux)"
run = [
  "dotnet build src/GhCredentialProvider/GhCredentialProvider.csproj -c Release",
  "mkdir -p ~/.nuget/plugins/netcore/gh-dotnet-credential-provider",
  "cp src/GhCredentialProvider/bin/Release/net10.0/*.dll ~/.nuget/plugins/netcore/gh-dotnet-credential-provider/",
  "cp src/GhCredentialProvider/bin/Release/net10.0/*.deps.json ~/.nuget/plugins/netcore/gh-dotnet-credential-provider/",
  "cp src/GhCredentialProvider/bin/Release/net10.0/*.runtimeconfig.json ~/.nuget/plugins/netcore/gh-dotnet-credential-provider/",
  "echo 'Plugin installed to ~/.nuget/plugins/netcore/gh-dotnet-credential-provider/'"
]

[tasks.integ-test]
depends = ["install"]
run = "NUGET_PLUGIN_PATHS='' dotnet -d tool install mxt"