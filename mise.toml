[tools]
dotnet = ["10"]

[tasks.build]
description = "Build the solution"
run = "dotnet build"

[tasks.build-release]
description = "Build the solution in Release configuration"
run = '''
  if [ -z "$VERSION" ]; then
    echo "VERSION is required"
    exit 1
  fi
  dotnet build src/GhCredentialProvider/GhCredentialProvider.csproj -c Release --no-restore -p:Version=$VERSION -p:PackageVersion=$VERSION
'''

[tasks.test]
description = "Run all tests"
run = "dotnet test"

[tasks.clean]
description = "Clean build artifacts"
run = "dotnet clean"

[tasks.restore]
description = "Restore NuGet packages"
run = "dotnet restore"

[tasks.install]
depends = ["build"]
description = "Install the locally-built plugin, for development testing."
run = '''
  dotnet tool uninstall -g nuget-plugin-github-credential-provider 2>/dev/null || true
  dotnet tool install -g --add-source src/GhCredentialProvider/bin/Debug nuget-plugin-github-credential-provider
'''

[tasks.publish]
depends = ["build-release"]
description = "Publish the package to NuGet.org"
run = '''
  dotnet nuget push ./src/GhCredentialProvider/bin/Release/*.nupkg \
    --api-key ${NUGET_API_KEY} \
    --source https://api.nuget.org/v3/index.json \
    --skip-duplicate
'''